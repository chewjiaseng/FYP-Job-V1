const loaderUtils = require('loader-utils')
const { requirePeer } = require('../lib/util')

module.exports = function loader(contentBuffer) {
  this.cacheable && this.cacheable()
  const callback = this.async()

  let content = contentBuffer.toString('utf8')
  // image file path
  const path = this.resourcePath

  // user options
  const config = {
    sharp: false,
    graphicsMagick: false,
    size: 9,
    ...loaderUtils.getOptions(this)
  }

  /** @see https://github.com/zouhir/lqip-loader */
  const contentIsUrlExp